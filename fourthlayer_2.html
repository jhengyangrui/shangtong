<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>多步驟 Step Process 向導</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0f172a;
      --card: #1e293b;
      --ink: #f1f5f9;
      --muted: #94a3b8;
      --accent: #38bdf8;
      --ring: #334155;
      --ok: #10b981;
      --warn: #f59e0b;
      --danger: #ef4444;
      --radius: 16px;
      --shadow: 0 12px 24px rgba(0,0,0,.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: linear-gradient(180deg,#0f172a,#1e293b 60%);
      color: var(--ink);
      font-family: 'Noto Sans TC', system-ui, sans-serif;
    }
    .container {
      max-width: 920px;
      margin: 0 auto;
      padding: 40px 24px;
    }
    h1 {
      font-size: clamp(28px, 4vw, 40px);
      margin: 0 0 10px;
    }
    p {
      color: var(--muted);
      margin-bottom: 24px;
    }
    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 30px;
    }
    .stepper {
      display: flex;
      justify-content: space-between;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      padding: 18px;
      border-radius: 14px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;
      position: relative;
      flex: 1;
      transition: 0.2s;
      z-index: 1;
    }
    .step:not(:last-child)::after {
      content: '';
      position: absolute;
      right: -50%;
      top: 50%;
      height: 2px;
      width: 100%;
      background: rgba(255,255,255,0.1);
      transform: translateY(-50%);
      z-index: 0;
    }
    /* 進度條背景與前景 */
    .progress {
      position: absolute;
      left: 18px;
      right: 18px;
      top: calc(50% - 1px);
      height: 2px;
      background: rgba(255,255,255,0.08);
      border-radius: 999px;
    }
    .progress i {
      display: block;
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, var(--accent), #60a5fa);
      transition: width .25s ease;
      border-radius: inherit;
    }

    .num {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      display: grid;
      place-items: center;
      font-weight: bold;
      color: var(--muted);
      border: 2px solid var(--ring);
      margin-bottom: 6px;
      background: #0f172a;
    }
    .step.active .num {
      color: var(--ink);
      border-color: var(--accent);
      background: var(--accent);
    }
    .step.done .num {
      background: var(--ok);
      border-color: var(--ok);
      color: #fff;
    }
    .label {
      font-size: 14px;
      color: var(--muted);
      text-align: center;
    }
    .label .sub { display:block; opacity:.9; font-size:12px; }
    .step.active .label { color: var(--ink); }

    .panel { display: none; }
    .panel.active { display: block; }
    .grid {
      display: grid;
      gap: 18px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      color: var(--muted);
    }
    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid var(--ring);
      background: #0f1a2e;
      color: var(--ink);
      font-size: 14px;
    }
    textarea { resize: vertical; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 4px; }
    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 24px;
    }
    .btn {
      padding: 10px 18px;
      border-radius: 10px;
      background: #1e293b;
      color: var(--ink);
      border: 1px solid var(--ring);
      cursor: pointer;
      transition: 0.2s;
    }
    .btn:hover {
      background: var(--accent);
      color: #03121a;
    }
    .btn.primary {
      background: var(--accent);
      border: none;
      color: #03121a;
    }
    .btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .summary {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 768px) {
      .summary { grid-template-columns: 1fr; }
    }
    .kv {
      background: rgba(255,255,255,.03);
      border: 1px dashed rgba(255,255,255,.08);
      padding: 14px;
      border-radius: 10px;
    }
    .kv b { display: block; margin-bottom: 4px; }
    footer {
      margin-top: 30px;
      color: var(--muted);
      text-align: center;
      font-size: 13px;
    }

    /* ===== 自營店鋪內容：調整字體、位置、大小 ===== */
    .shop-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      padding: 12px;
      border: 1px solid var(--ring);
      border-radius: 10px;
      background: #0f1a2e;
    }
    .shop-options label {
      display: flex;               /* 讓 checkbox 與文字同列、置中 */
      align-items: center;
      gap: 8px;                    /* 勾選框與文字間距 */
      font-size: 18px;             /* 文字變大 */
      color: var(--ink);           /* 深色底用亮字 */
      line-height: 1.2;
      white-space: nowrap;
    }
    .shop-options input[type="checkbox"] {
      transform: scale(1.35);      /* 放大勾選框 */
      accent-color: var(--accent); /* 勾選顏色（支援的瀏覽器） */
    }
    .shop-options .shop-note {
      grid-column: 1 / -1;         /* 跨整列寬度 */
      font-size: 16px;
    }

    /* radio 區塊也順手對齊一下（非必要） */
    .radio-group {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px;
      border: 1px solid var(--ring);
      border-radius: 10px;
      background: #0f1a2e;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 16px;
      color: var(--ink);
      margin: 0;
    }
    .radio-group input[type="radio"] {
      transform: scale(1.2);
      accent-color: var(--accent);
    }

    /* 驗證提示（原本就有切換 class，可自行延伸） */
    .invalid { outline: 2px solid var(--danger); }
    .ok { outline: 2px solid var(--ok); outline-offset: 0; }
    .business-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
    padding: 12px;
    border: 1px solid var(--ring);
    border-radius: 10px;
    background: #0f1a2e;
    }

    .business-options label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 16px;
    white-space: nowrap;
    }

    .business-options input[type="checkbox"] {
    transform: scale(1.2);
    accent-color: var(--accent);
    }

    /* 其他 + 輸入框 */
    .business-options .other-biz {
    gap: 8px;
    }
    .business-options .other-biz .biz-note {
    flex: 1;
    min-width: 100px;
    font-size: 14px;
    }
.type-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.type-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.type-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}
.course-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.course-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.course-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}
.channel-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.channel-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.channel-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}
.area-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.area-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.area-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}

.area-options .other-area {
  gap: 8px;
}

.area-options .other-area .area-note {
  flex: 1;
  min-width: 100px;
  font-size: 14px;
}
.source-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.source-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.source-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}

.source-options .other-source {
  gap: 8px;
}

.source-options .other-source .source-note {
  flex: 1;
  min-width: 100px;
  font-size: 14px;
}
.demand-options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 10px;
  padding: 12px;
  border: 1px solid var(--ring);
  border-radius: 10px;
  background: #0f1a2e;
}

.demand-options label {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 16px;
  white-space: nowrap;
}

.demand-options input[type="checkbox"] {
  transform: scale(1.2);
  accent-color: var(--accent);
}
#interview {
  font-size: 15px;
  line-height: 1.6;
}

  </style>
</head>
<body>
  <div class="container">
    <div class="card pad">
      <!-- Stepper Header -->
      <div class="stepper" role="tablist" aria-label="步驟導覽">
        <div class="step active" role="tab" aria-selected="true" aria-controls="panel-1" id="tab-1" data-step="1">
          <div class="num">1</div>
          <div class="label"><b>基本資料</b><span class="sub">姓名 / Email</span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-2" id="tab-2" data-step="2">
          <div class="num">2</div>
          <div class="label"><b>需求設定</b><span class="sub">用途 / 範圍</span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-3" id="tab-3" data-step="3">
          <div class="num">3</div>
          <div class="label"><b>確認內容</b><span class="sub">摘要預覽</span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-4" id="tab-4" data-step="4">
          <div class="num">4</div>
          <div class="label"><b>完成提交</b><span class="sub">送出 / 下載</span></div>
        </div>
        <div class="progress" aria-hidden="true"><i id="progressbar"></i></div>
      </div>

      <!-- Panels -->
      <div class="panels">
        <!-- Step 1 -->
<section class="panel active" id="panel-1" role="tabpanel" aria-labelledby="tab-1">
  <div class="grid">
    <div>
      <label for="date">填表日期</label>
      <input id="date" type="date" required />
    </div>
    <div>
      <label for="name">姓名</label>
      <input id="name" type="text" placeholder="王小明" required />
    </div>
    <div>
      <label>性別</label>
      <div class="radio-group">
        <label>
          <input type="radio" name="gender" value="男" required />
          男
        </label>
        <label>
          <input type="radio" name="gender" value="女" required />
          女
        </label>
      </div>
    </div>
    <div>
      <label for="address">住址</label>
      <input id="address" type="text" placeholder="完整住址（含郵遞區號）" required />
    </div>
    <div>
      <label for="course">課程預約</label>
      <input id="course" type="text" placeholder="請輸入想上的課程名稱" />
    </div>
    <div>
      <label for="tel">電話</label>
      <input id="tel" type="tel" placeholder="(02)1234-5678" />
    </div>
    <div>
      <label for="mobile">行動電話</label>
      <input id="mobile" type="tel" placeholder="0912-345-678" />
    </div>
    <div>
      <label for="messenger">通訊軟體</label>
      <input id="messenger" type="text" placeholder="LINE / WeChat / IG..." />
    </div>
    <div>
      <label for="email">Email</label>
      <input id="email" type="email" placeholder="you@example.com" required />
    </div>
    <div style="grid-column: span 2">
      <label>自營店鋪內容（可複選）</label>
      <!-- ✅ 已加上 .shop-options -->
      <div class="shop-options">
        <label><input type="checkbox" name="shop" value="茶飲店" /> 茶飲店</label>
        <label><input type="checkbox" name="shop" value="冰品店" /> 冰品店</label>
        <label><input type="checkbox" name="shop" value="複合式簡餐" /> 複合式簡餐</label>
        <label><input type="checkbox" name="shop" value="咖啡店" /> 咖啡店</label>
        <label><input type="checkbox" name="shop" value="早餐店" /> 早餐店</label>
        <label><input type="checkbox" name="shop" value="炸雞店" /> 炸雞店</label>
        <label><input type="checkbox" name="shop" value="滷味店" /> 滷味店</label>
        <label><input type="checkbox" name="shop" value="火鍋店" /> 火鍋店</label>
        <label><input type="checkbox" name="shop" value="其他" /> 其他
        <input type="text" class="shop-note" placeholder="請輸入店型名稱" /></label>
        <label><input type="checkbox" name="shop" value="無相關經驗" /> 無相關經驗</label>        
      </div>
    </div>
    <div style="grid-column: span 2">
        <label>希望經營方式（可複選）</label>
        <div class="business-options">
            <label><input type="checkbox" name="biz" value="行動式" /> 行動式</label>
            <label><input type="checkbox" name="biz" value="店面式" /> 店面式</label>
            <label><input type="checkbox" name="biz" value="原料批發" /> 原料批發</label>
            <label class="other-biz">
            <input type="checkbox" name="biz" value="其他" /> 其他
            <input type="text" class="biz-note" placeholder="請輸入方式" />
            </label>
        </div>
    </div>
    <div style="grid-column: span 2">
        <label>希望經營型態（可複選）</label>
        <div class="type-options">
            <label><input type="checkbox" name="type" value="外帶飲品" /> 外帶飲品</label>
            <label><input type="checkbox" name="type" value="烘焙" /> 烘焙</label>
            <label><input type="checkbox" name="type" value="咖啡店" /> 咖啡店</label>
            <label><input type="checkbox" name="type" value="下午茶店" /> 下午茶店</label>
            <label><input type="checkbox" name="type" value="早餐店" /> 早餐店</label>
            <label><input type="checkbox" name="type" value="複合式餐廳" /> 複合式餐廳</label>
            <label><input type="checkbox" name="type" value="百貨/賣場/超市" /> 百貨/賣場/超市</label>
            <label><input type="checkbox" name="type" value="娛樂休閒" /> 娛樂休閒</label>
            <label><input type="checkbox" name="type" value="飯店" /> 飯店</label>
            <label><input type="checkbox" name="type" value="品牌代工" /> 品牌代工</label>
            <label><input type="checkbox" name="type" value="教學/學校" /> 教學/學校</label>
        </div>
    </div>
    <div style="grid-column: span 2">
        <label>課程名稱（可複選）</label>
        <div class="course-options">
            <label><input type="checkbox" name="courseName" value="茶飲速成班" /> 茶飲速成班</label>
            <label><input type="checkbox" name="courseName" value="手工甜品課" /> 手工甜品課</label>
            <label><input type="checkbox" name="courseName" value="茶飲課程X天" /> 茶飲課程X天</label>
            <label><input type="checkbox" name="courseName" value="綿密雪花冰課" /> 綿密雪花冰課</label>
            <label><input type="checkbox" name="courseName" value="異國輕食課" /> 異國輕食課</label>
            <label><input type="checkbox" name="courseName" value="手工咖啡課" /> 手工咖啡課</label>
        </div>
    </div>
<div style="grid-column: span 2">
  <label>特定通路（可複選）</label>
  <div class="channel-options">
    <label><input type="checkbox" name="channel" value="盤商" /> 盤商</label>
    <label><input type="checkbox" name="channel" value="零售" /> 零售</label>
    <label><input type="checkbox" name="channel" value="批發" /> 批發</label>
    <label><input type="checkbox" name="channel" value="代理商" /> 代理商</label>
    <label><input type="checkbox" name="channel" value="經銷" /> 經銷</label>
  </div>
</div>
<div style="grid-column: span 2">
  <label>附近主要商圈（可複選）</label>
  <div class="area-options">
    <label><input type="checkbox" name="area" value="辦公大樓" /> 辦公大樓</label>
    <label><input type="checkbox" name="area" value="夜市" /> 夜市</label>
    <label><input type="checkbox" name="area" value="學校" /> 學校</label>
    <label><input type="checkbox" name="area" value="住宅" /> 住宅</label>
    <label class="other-area">
      <input type="checkbox" name="area" value="其他" /> 其他
      <input type="text" class="area-note" placeholder="請輸入商圈名稱" />
    </label>
  </div>
</div>
<div style="grid-column: span 2">
  <label>訊息來源（可複選）</label>
  <div class="source-options">
    <label><input type="checkbox" name="source" value="DM" /> DM</label>
    <label><input type="checkbox" name="source" value="親友介紹" /> 親友介紹</label>
    <label><input type="checkbox" name="source" value="廣告/媒體" /> 廣告/媒體</label>
    <label><input type="checkbox" name="source" value="網路搜尋" /> 網路搜尋</label>
    <label><input type="checkbox" name="source" value="FB 粉絲團" /> FB 粉絲團</label>
    <label><input type="checkbox" name="source" value="YouTube" /> YouTube</label>
    <label><input type="checkbox" name="source" value="學員介紹" /> 學員介紹</label>
    <label><input type="checkbox" name="source" value="店家/廠商介紹/展銷活動" /> 店家/廠商介紹(展銷活動)</label>
    <label><input type="checkbox" name="source" value="奇麗灣珍奶文化館" /> 奇麗灣珍奶文化館</label>
    <label class="other-source">
      <input type="checkbox" name="source" value="其他" /> 其他
      <input type="text" class="source-note" placeholder="請輸入來源" />
    </label>
  </div>
</div>
<div style="grid-column: span 2">
  <label>客戶需求（可複選）</label>
  <div class="demand-options">
    <label><input type="checkbox" name="demand" value="茶葉" /> 茶葉</label>
    <label><input type="checkbox" name="demand" value="糖漿" /> 糖漿</label>
    <label><input type="checkbox" name="demand" value="果汁" /> 果汁</label>
    <label><input type="checkbox" name="demand" value="淋醬/配料" /> 淋醬/配料</label>
    <label><input type="checkbox" name="demand" value="果粉/奶精" /> 果粉/奶精</label>
    <label><input type="checkbox" name="demand" value="珍珠" /> 珍珠</label>
    <label><input type="checkbox" name="demand" value="咖啡豆" /> 咖啡豆</label>
    <label><input type="checkbox" name="demand" value="器具/設備" /> 器具/設備</label>
  </div>
</div>
<div style="grid-column: span 2">
  <label for="location">開店地點</label>
  <input id="location" type="text" placeholder="請輸入開店地點" />
</div>

<div style="grid-column: span 2">
  <label for="interview">訪談內容</label>
  <textarea id="interview" rows="6" placeholder="請輸入訪談內容…"></textarea>
</div>

    
    
  </div>

  <div class="actions">
    <button class="btn ghost" data-prev disabled>← 上一步</button>
    <div style="display:flex;gap:10px">
      <button class="btn" data-save>暫存</button>
      <button class="btn primary" data-next>下一步 →</button>
    </div>
  </div>
</section>

        <!-- Step 2 -->
        <section class="panel" id="panel-2" role="tabpanel" aria-labelledby="tab-2">
          <div class="grid">
            <div>
              <label for="use">使用用途</label>
              <select id="use" required>
                <option value="">請選擇</option>
                <option>報價詢問</option>
                <option>產品試用</option>
                <option>技術支援</option>
              </select>
            </div>
            <div>
              <label for="scope">預計範圍</label>
              <select id="scope" required>
                <option value="">請選擇</option>
                <option>個人</option>
                <option>小型團隊（2-10人）</option>
                <option>中型團隊（11-50人）</option>
                <option>大型組織（50+）</option>
              </select>
            </div>
          </div>
          <label for="desc" style="margin-top:8px;display:block">補充說明</label>
          <textarea id="desc" rows="5" placeholder="請簡述您的需求…"></textarea>
          <div class="actions">
            <button class="btn" data-prev>← 上一步</button>
            <div style="display:flex;gap:10px">
              <button class="btn" data-save>暫存</button>
              <button class="btn primary" data-next>下一步 →</button>
            </div>
          </div>
        </section>

        <!-- Step 3 -->
        <section class="panel" id="panel-3" role="tabpanel" aria-labelledby="tab-3">
          <div class="summary" id="summary"></div>
          <div class="actions">
            <button class="btn" data-prev>← 上一步</button>
            <div style="display:flex;gap:10px">
              <button class="btn" data-save>暫存</button>
              <button class="btn primary" data-next>確認送出 →</button>
            </div>
          </div>
        </section>

        <!-- Step 4 -->
        <section class="panel" id="panel-4" role="tabpanel" aria-labelledby="tab-4">
          <div class="pad" style="background:rgba(52,211,153,.08);border:1px solid rgba(52,211,153,.35);border-radius:12px">
            <b>已完成！</b>
            <p class="hint">資料已模擬提交。你可以返回任一步驟修改，或下載 JSON。</p>
          </div>
          <div class="actions">
            <button class="btn" data-prev>← 返回修改</button>
            <div style="display:flex;gap:10px">
              <button class="btn" id="btnDownload">下載 JSON</button>
              <button class="btn primary" id="btnReset">重新開始 ↺</button>
            </div>
          </div>
        </section>
      </div>

      <footer>© 2025 Stepper Demo · 無框架、單檔可用 · 可自由改成 3/5/6 步</footer>
    </div>
  </div>

  <script>
    // === 基本狀態 ===
    const steps = Array.from(document.querySelectorAll('.stepper .step'));
    const panels = Array.from(document.querySelectorAll('.panels .panel'));
    const progress = document.getElementById('progressbar');
    let idx = 0; // 0-based

    // 從 localStorage 載入暫存（可移除）
    const STORE_KEY = 'stepper-demo';
    const store = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');
    for (const [id,val] of Object.entries(store)){
      const el = document.getElementById(id);
      if(el){ el.value = val; }
    }

    // 事件：點選步驟標頭（僅可跳到已完成或當前之後的步驟）
    steps.forEach((tab,i)=>{
      tab.addEventListener('click',()=>{
        const maxReach = getMaxReach();
        if(i <= maxReach) go(i);
      })
    })

    // 綁定上一/下一步、暫存、下載、重設
    document.querySelectorAll('[data-next]').forEach(b=>b.addEventListener('click',()=>advance(1)));
    document.querySelectorAll('[data-prev]').forEach(b=>b.addEventListener('click',()=>advance(-1)));
    document.querySelectorAll('[data-save]').forEach(b=>b.addEventListener('click',save));
    document.getElementById('btnDownload')?.addEventListener('click',downloadJSON);
    document.getElementById('btnReset')?.addEventListener('click',()=>{ localStorage.removeItem(STORE_KEY); location.reload(); });

    // 鍵盤可用性：左右鍵切換
    document.addEventListener('keydown',(e)=>{
      if(e.key==='ArrowRight') advance(1);
      if(e.key==='ArrowLeft') advance(-1);
    });

    render();

    function advance(delta){
      if(delta>0 && !validate(idx)) return; // 未過驗證不能往下
      const target = Math.max(0, Math.min(steps.length-1, idx+delta));
      go(target);
    }

    function go(i){
      idx = i; render();
      panels[idx].scrollIntoView({behavior:'smooth', block:'nearest'});
    }

    function render(){
      // 標頭樣式、ARIA
      steps.forEach((s,i)=>{
        s.classList.toggle('active', i===idx);
        s.classList.toggle('done', i<idx);
        s.setAttribute('aria-selected', i===idx ? 'true':'false');
      });
      panels.forEach((p,i)=>{
        p.classList.toggle('active', i===idx);
        p.setAttribute('aria-hidden', i===idx ? 'false':'true');
      });
      // 進度條
      const ratio = (idx)/(steps.length-1);
      progress.style.width = (ratio*100)+"%";
    }

    function getMaxReach(){
      // 允許跳轉到已完成的最後一步（idx）
      return idx;
    }

    // === 驗證（可自訂規則） ===
    function validate(i){
      let ok = true;
      if(i===0){
        ok &= validateRequired('name');
        ok &= validateEmail('email');
      }
      if(i===1){
        ok &= validateRequired('use');
        ok &= validateRequired('scope');
      }
      if(i===2){
        // 生成摘要供檢查
        buildSummary();
        ok &= true;
      }
      return !!ok;
    }

    function validateRequired(id){
      const el = document.getElementById(id);
      const valid = !!el.value?.trim();
      el.classList.toggle('invalid', !valid);
      el.classList.toggle('ok', valid);
      return valid;
    }
    function validateEmail(id){
      const el = document.getElementById(id);
      const valid = /.+@.+\..+/.test(el.value);
      el.classList.toggle('invalid', !valid);
      el.classList.toggle('ok', valid);
      return valid;
    }

    function buildSummary(){
      const data = collect();
      const sum = document.getElementById('summary');
      sum.innerHTML = '';
      const entries = [
        ['姓名', data.name || '-'],
        ['Email', data.email || '-'],
        ['用途', data.use || '-'],
        ['範圍', data.scope || '-'],
        ['補充說明', data.desc || '-']
      ];
      for(const [k,v] of entries){
        const d = document.createElement('div');
        d.className='kv';
        d.innerHTML = `<b>${k}</b><div>${escapeHTML(v)}</div>`;
        sum.appendChild(d);
      }
    }

    function collect(){
      return {
        name: document.getElementById('name').value.trim(),
        email: document.getElementById('email').value.trim(),
        use: document.getElementById('use').value,
        scope: document.getElementById('scope').value,
        desc: document.getElementById('desc').value.trim(),
      };
    }

    function save(){
      const data = collect();
      localStorage.setItem(STORE_KEY, JSON.stringify({
        name:data.name, email:data.email, use:data.use, scope:data.scope, desc:data.desc
      }));
      alert('已暫存到瀏覽器（localStorage）。');
    }

    function downloadJSON(){
      const data = collect();
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'stepper-data.json';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    // 簡單 escape，避免 innerHTML 注入
    function escapeHTML(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m]));
    }
  </script>
</body>
</html>
