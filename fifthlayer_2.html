<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>多步驟 Step Process 向導</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
  <style>
  :root {
    --bg: #ffffff; /* Bright white background */
    --card: #f9f9f9; /* Light card background */
    --ink: #1f2937; /* Darker text color for contrast */
    --muted: #6b7280; /* Muted text color */
    --accent: #2563eb; /* Bright blue accent */
    --ring: #d1d5db; /* Light border color */
    --ok: #22c55e; /* Bright green for correct answers */
    --warn: #f59e0b; /* Bright orange for warnings */
    --danger: #ef4444; /* Bright red for errors */
    --radius: 16px; /* Border radius */
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.1); /* Softer shadow */
  }

  * {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    background: var(--bg); /* Bright background */
    color: var(--ink);
    font-family: 'Noto Sans TC', system-ui, sans-serif;
  }

  .container {
    max-width: 920px;
    margin: 0 auto;
    padding: 40px 24px;
  }

  h1 {
    font-size: clamp(28px, 4vw, 40px);
    margin: 0 0 10px;
    color: var(--ink);
  }

  p {
    color: var(--muted);
    margin-bottom: 24px;
  }

  .card {
    background: var(--card);
    border: 1px solid var(--ring);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 30px;
  }

  /* Stepper */
  .stepper {
    display: flex;
    justify-content: space-between;
    background: rgba(37, 99, 235, 0.05); /* Light blue background */
    border: 1px solid var(--ring);
    padding: 18px;
    border-radius: 14px;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }
  .step {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    position: relative;
    flex: 1;
    transition: 0.2s;
    z-index: 1;
  }
  .step:not(:last-child)::after {
    content: '';
    position: absolute;
    right: -50%;
    top: 50%;
    height: 2px;
    width: 100%;
    background: var(--ring);
    transform: translateY(-50%);
    z-index: 0;
  }
  .num {
    width: 32px;
    height: 32px;
    border-radius: 999px;
    display: grid;
    place-items: center;
    font-weight: bold;
    color: var(--muted);
    border: 2px solid var(--ring);
    margin-bottom: 6px;
    background: var(--card);
  }
  .step.active .num {
    color: #fff;
    border-color: var(--accent);
    background: var(--accent);
  }
  .step.done .num {
    background: var(--ok);
    border-color: var(--ok);
    color: #fff;
  }
  .label {
    font-size: 14px;
    color: var(--muted);
    text-align: left;
  }
  .label .sub {
    display: block;
    opacity: 0.9;
    font-size: 12px;
  }
  .step.active .label {
    color: var(--ink);
  }
  .progress {
    position: absolute;
    left: 18px;
    right: 18px;
    top: calc(50% - 1px);
    height: 2px;
    background: var(--ring);
    border-radius: 999px;
  }
  .progress i {
    display: block;
    height: 100%;
    width: 0%;
    background: linear-gradient(90deg, var(--accent), #60a5fa);
    border-radius: inherit;
    transition: width 0.25s ease;
  }

  .panel {
    display: none;
  }

  .panel.active {
    display: block;
  }

  .grid {
    display: grid;
    gap: 18px;
    grid-template-columns: 1fr 1fr;
  }

  @media (max-width: 768px) {
    .grid {
      grid-template-columns: 1fr;
    }
  }

  label {
    display: block;
    margin-bottom: 6px;
    font-size: 13px;
    color: var(--muted);
  }

  input,
  select,
  textarea {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid var(--ring);
    background: var(--card);
    color: var(--ink);
    font-size: 14px;
  }

  textarea {
    resize: vertical;
  }

  .hint {
    font-size: 12px;
    color: var(--muted);
    margin-top: 4px;
  }

  .actions {
    display: flex;
    justify-content: flex-end;
    margin-top: 24px;
    gap: 10px;
  }

  .btn {
    padding: 10px 18px;
    border-radius: 10px;
    background: var(--accent);
    color: #fff;
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }

  .btn:hover {
    background: #1e40af;
  }

  .btn.primary {
    background: var(--accent);
    border: none;
    color: #fff;
  }

  .btn[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
  }

  footer {
    margin-top: 30px;
    color: var(--muted);
    text-align: left;
    font-size: 13px;
  }

  /* 群組樣式（checkbox 區塊） */
  .shop-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    padding: 12px;
    border: 1px solid var(--ring);
    border-radius: 10px;
    background: #0f1a2e;
  }
  .shop-options label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 18px;
    color: var(--ink);
    line-height: 1.2;
    white-space: nowrap;
  }
  .shop-options input[type="checkbox"] {
    transform: scale(1.35);
    accent-color: var(--accent);
  }
  .shop-options .shop-note {
    grid-column: 1 / -1;
    font-size: 16px;
  }

  .radio-group {
    display: flex;
    gap: 12px;
    align-items: center;
    padding: 12px;
    border: 1px solid var(--ring);
    border-radius: 10px;
    background: #0f1a2e;
  }
  .radio-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 16px;
    color: var(--ink);
    margin: 0;
  }
  .radio-group input[type="radio"] {
    transform: scale(1.2);
    accent-color: var(--accent);
  }

  .business-options,
  .type-options,
  .course-options,
  .channel-options,
  .area-options,
  .source-options,
  .demand-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 10px;
    padding: 12px;
    border: 1px solid var(--ring);
    border-radius: 10px;
    background: #0f1a2e;
  }
  .business-options label,
  .type-options label,
  .course-options label,
  .channel-options label,
  .area-options label,
  .source-options label,
  .demand-options label {
    display: flex;
    align-items: center;
    gap: 8px; /* Space between checkbox and text */
    font-size: 16px;
    white-space: nowrap;
  }
  .business-options input[type="checkbox"],
  .type-options input[type="checkbox"],
  .course-options input[type="checkbox"],
  .channel-options input[type="checkbox"],
  .area-options input[type="checkbox"],
  .source-options input[type="checkbox"],
  .demand-options input[type="checkbox"] {
    transform: scale(1.2); /* Adjust checkbox size */
    accent-color: var(--accent); /* Use the accent color */
    margin-right: 8px; /* Add space between checkbox and text */
  }

  .business-options .other-biz,
  .area-options .other-area,
  .source-options .other-source {
    gap: 8px;
  }
  .business-options .biz-note,
  .area-options .area-note,
  .source-options .source-note {
    flex: 1;
    min-width: 100px;
    font-size: 14px;
  }

  #interview {
    font-size: 15px;
    line-height: 1.6;
  }

  /* Add this rule to make span text bright */
  span {
    color: #8aabf3; /* Bright blue color */
  }
    /* 讓文字靠右 */
  .shop-options label,
  .business-options label,
  .type-options label,
  .course-options label,
  .channel-options label,
  .area-options label,
  .source-options label,
  .demand-options label {
    justify-content: flex-start; /* 將文字靠右 */
    text-align: left; /* 文字對齊左側 */
  }

  /* 修正背景顏色 */
  .shop-options,
  .business-options,
  .type-options,
  .course-options,
  .channel-options,
  .area-options,
  .source-options,
  .demand-options {
    background: var(--card); /* 使用亮色背景 */
    border: 1px solid var(--ring);
    border-radius: 10px;
    padding: 12px;
  }

  .radio-group {
    background: var(--card); /* 使用亮色背景 */
    border: 1px solid var(--ring);
    border-radius: 10px;
    padding: 12px;
  }

  .shop-options label,
  .business-options label,
  .type-options label,
  .course-options label,
  .channel-options label,
  .area-options label,
  .source-options label,
  .demand-options label {
    color: var(--ink); /* 確保文字顏色與亮色背景對比清晰 */
  }

  .shop-options .shop-note,
  .business-options .biz-note,
  .area-options .area-note,
  .source-options .source-note {
    background: var(--card); /* 使用亮色背景 */
    border: 1px solid var(--ring);
    color: var(--ink);
  }

  /* 讓所有文字靠左 */
  body, h1, h2, h3, h4, h5, h6, p, label, .label, .btn, .hint, .actions {
    text-align: left; /* 文字靠左對齊 */
  }

  .shop-options label,
  .business-options label,
  .type-options label,
  .course-options label,
  .channel-options label,
  .area-options label,
  .source-options label,
  .demand-options label {
    text-align: left; /* 確保 checkbox 文字靠左 */
  }
  </style>
</head>
<body>
  <div class="container">
    <div class="card pad">
      <!-- Stepper：4 步 -->
      <div class="stepper" role="tablist" aria-label="步驟導覽">
        <div class="step active" role="tab" aria-selected="true" aria-controls="panel-1" id="tab-1" data-step="1">
          <div class="num">1</div>
          <div class="label"><b>基本資料</b><span class="sub">填寫並下載</span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-2" id="tab-2" data-step="2">
          <div class="num">2</div>
          <div class="label"><b>官網</b><span class="sub"></span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-3" id="tab-3" data-step="3">
          <div class="num">3</div>
          <div class="label"><b>茶飲測試</b><span class="sub"></span></div>
        </div>
        <div class="step" role="tab" aria-selected="false" aria-controls="panel-4" id="tab-4" data-step="4">
          <div class="num">4</div>
          <div class="label"><b>購物平台</b><span class="sub"></span></div>
        </div>
        <div class="progress" aria-hidden="true"><i id="progressbar"></i></div>
      </div>

      <!-- Panels -->
      <div class="panels">
        <!-- Step 1 -->
        <section class="panel active" id="panel-1" role="tabpanel" aria-labelledby="tab-1">
          <div class="grid">
            <div>
              <label for="date">填表日期</label>
              <input id="date" type="date" required />
            </div>
            <div>
              <label for="name">姓名</label>
              <input id="name" type="text" placeholder="王小明" required />
            </div>
            <div>
              <label>性別</label>
              <div class="radio-group">
                <label><input type="radio" name="gender" value="男" required /> 男</label>
                <label><input type="radio" name="gender" value="女" required /> 女</label>
              </div>
            </div>
            <div>
              <label for="address">住址</label>
              <input id="address" type="text" placeholder="完整住址（含郵遞區號）" required />
            </div>
            <div>
              <label for="course">課程預約</label>
              <input id="course" type="text" placeholder="請輸入想上的課程名稱" />
            </div>
            <div>
              <label for="tel">電話</label>
              <input id="tel" type="tel" placeholder="(02)1234-5678" />
            </div>
            <div>
              <label for="mobile">行動電話</label>
              <input id="mobile" type="tel" placeholder="0912-345-678" />
            </div>
            <div>
              <label for="messenger">通訊軟體</label>
              <input id="messenger" type="text" placeholder="LINE / WeChat / IG..." />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="you@example.com" required />
            </div>

            <div style="grid-column: span 2">
              <label>自營店鋪內容（可複選）</label>
              <div class="shop-options">
                <label><input type="checkbox" name="shop" value="茶飲店" /> 茶飲店</label>
                <label><input type="checkbox" name="shop" value="冰品店" /> 冰品店</label>
                <label><input type="checkbox" name="shop" value="複合式簡餐" /> 蘭合式簡餐</label>
                <label><input type="checkbox" name="shop" value="咖啡店" /> 咖啡店</label>
                <label><input type="checkbox" name="shop" value="早餐店" /> 早餐店</label>
                <label><input type="checkbox" name="shop" value="炸雞店" /> 炸雞店</label>
                <label><input type="checkbox" name="shop" value="滷味店" /> 滷味店</label>
                <label><input type="checkbox" name="shop" value="火鍋店" /> 火鍋店</label>
                <label><input type="checkbox" name="shop" value="其他" /> 其他 <input type="text" class="shop-note" placeholder="請輸入店型名稱" /></label>
                <label><input type="checkbox" name="shop" value="無相關經驗" /> 無相關經驗</label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>希望經營方式（可複選）</label>
              <div class="business-options">
                <label><input type="checkbox" name="biz" value="行動式" /> 行動式</label>
                <label><input type="checkbox" name="biz" value="店面式" /> 店面式</label>
                <label><input type="checkbox" name="biz" value="原料批發" /> 原料批發</label>
                <label class="other-biz"><input type="checkbox" name="biz" value="其他" /> 其他 <input type="text" class="biz-note" placeholder="請輸入方式" /></label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>希望經營型態（可複選）</label>
              <div class="type-options">
                <label><input type="checkbox" name="type" value="外帶飲品" /> 外帶飲品</label>
                <label><input type="checkbox" name="type" value="烘焙" /> 烘焙</label>
                <label><input type="checkbox" name="type" value="咖啡店" /> 咖啡店</label>
                <label><input type="checkbox" name="type" value="下午茶店" /> 下午茶店</label>
                <label><input type="checkbox" name="type" value="早餐店" /> 早餐店</label>
                <label><input type="checkbox" name="type" value="複合式餐廳" /> 複合式餐廳</label>
                <label><input type="checkbox" name="type" value="百貨/賣場/超市" /> 百貨/賣場/超市</label>
                <label><input type="checkbox" name="type" value="娛樂休閒" /> 娛樂休閒</label>
                <label><input type="checkbox" name="type" value="飯店" /> 飯店</label>
                <label><input type="checkbox" name="type" value="品牌代工" /> 品牌代工</label>
                <label><input type="checkbox" name="type" value="教學/學校" /> 教學/學校</label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>課程名稱（可複選）</label>
              <div class="course-options">
                <label><input type="checkbox" name="courseName" value="茶飲速成班" /> 茶飲速成班</label>
                <label><input type="checkbox" name="courseName" value="手工甜品課" /> 手工甜品課</label>
                <label><input type="checkbox" name="courseName" value="茶飲課程X天" /> 茶飲課程X天</label>
                <label><input type="checkbox" name="courseName" value="綿密雪花冰課" /> 綿密雪花冰課</label>
                <label><input type="checkbox" name="courseName" value="異國輕食課" /> 異國輕食課</label>
                <label><input type="checkbox" name="courseName" value="手工咖啡課" /> 手工咖啡課</label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>特定通路（可複選）</label>
              <div class="channel-options">
                <label><input type="checkbox" name="channel" value="盤商" /> 盤商</label>
                <label><input type="checkbox" name="channel" value="零售" /> 零售</label>
                <label><input type="checkbox" name="channel" value="批發" /> 批發</label>
                <label><input type="checkbox" name="channel" value="代理商" /> 代理商</label>
                <label><input type="checkbox" name="channel" value="經銷" /> 經銷</label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>附近主要商圈（可複選）</label>
              <div class="area-options">
                <label><input type="checkbox" name="area" value="辦公大樓" /> 辦公大樓</label>
                <label><input type="checkbox" name="area" value="夜市" /> 夜市</label>
                <label><input type="checkbox" name="area" value="學校" /> 學校</label>
                <label><input type="checkbox" name="area" value="住宅" /> 住宅</label>
                <label class="other-area"><input type="checkbox" name="area" value="其他" /> 其他 <input type="text" class="area-note" placeholder="請輸入商圈名稱" /></label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>訊息來源（可複選）</label>
              <div class="source-options">
                <label><input type="checkbox" name="source" value="DM" /> DM</label>
                <label><input type="checkbox" name="source" value="親友介紹" /> 親友介紹</label>
                <label><input type="checkbox" name="source" value="廣告/媒體" /> 廣告/媒體</label>
                <label><input type="checkbox" name="source" value="網路搜尋" /> 網路搜尋</label>
                <label><input type="checkbox" name="source" value="FB 粉絲團" /> FB 粉絲團</label>
                <label><input type="checkbox" name="source" value="YouTube" /> YouTube</label>
                <label><input type="checkbox" name="source" value="學員介紹" /> 學員介紹</label>
                <label><input type="checkbox" name="source" value="店家/廠商介紹/展銷活動" /> 店家/廠商介紹(展銷活動)</label>
                <label><input type="checkbox" name="source" value="奇麗灣珍奶文化館" /> 奇麗灣珍奶文化館</label>
                <label class="other-source"><input type="checkbox" name="source" value="其他" /> 其他 <input type="text" class="source-note" placeholder="請輸入來源" /></label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label>客戶需求（可複選）</label>
              <div class="demand-options">
                <label><input type="checkbox" name="demand" value="茶葉" /> 茶葉</label>
                <label><input type="checkbox" name="demand" value="糖漿" /> 糖漿</label>
                <label><input type="checkbox" name="demand" value="果汁" /> 果汁</label>
                <label><input type="checkbox" name="demand" value="淋醬/配料" /> 淋醬/配料</label>
                <label><input type="checkbox" name="demand" value="果粉/奶精" /> 果粉/奶精</label>
                <label><input type="checkbox" name="demand" value="珍珠" /> 珍珠</label>
                <label><input type="checkbox" name="demand" value="咖啡豆" /> 咖啡豆</label>
                <label><input type="checkbox" name="demand" value="器具/設備" /> 器具/設備</label>
              </div>
            </div>

            <div style="grid-column: span 2">
              <label for="location">開店地點</label>
              <input id="location" type="text" placeholder="請輸入開店地點" />
            </div>

            <div style="grid-column: span 2">
              <label for="interview">訪談內容</label>
              <textarea id="interview" rows="6" placeholder="請輸入訪談內容…"></textarea>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="btnSave">暫存</button>
            <!-- <button class="btn" id="btnGoExternal">外部連結</button> -->
            <button class="btn primary" id="btnSummit">summit</button>
          </div>
        </section>

        <!-- Step 2：外部連結 A -->
        <section class="panel" id="panel-2" role="tabpanel" aria-labelledby="tab-2">
          <div class="pad" style="background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.35);border-radius:12px;padding:16px;">
            <b>官網</b>
          </div>
          <div class="actions" style="justify-content:flex-start;">
            <a class="btn primary" id="btnOpenLink2" href="#" target="_blank" rel="noopener">打開官網↗</a>
            <button class="btn" id="btnBack2">← 回到填寫</button>
          </div>
        </section>

        <!-- Step 3：外部連結 B -->
        <section class="panel" id="panel-3" role="tabpanel" aria-labelledby="tab-3">
          <div class="pad" style="background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.35);border-radius:12px;padding:16px;">
            <b>茶飲測試</b>
          </div>
          <div class="actions" style="justify-content:flex-start;">
            <a class="btn primary" id="btnOpenLink3" href="#" target="_blank" rel="noopener">打開茶飲測試↗</a>
            <button class="btn" id="btnBack3">← 回到填寫</button>
          </div>
        </section>

        <!-- Step 4：外部連結 C -->
        <section class="panel" id="panel-4" role="tabpanel" aria-labelledby="tab-4">
          <div class="pad" style="background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.35);border-radius:12px;padding:16px;">
            <b>購物平台</b>
          </div>
          <div class="actions" style="justify-content:flex-start;">
            <a class="btn primary" id="btnOpenLink4" href="#" target="_blank" rel="noopener">打開購物平台↗</a>
            <button class="btn" id="btnBack4">← 回到填寫</button>
          </div>
        </section>
      </div>

      <footer>© 2025 Stepper Demo · 四步版本 · Step2/3/4 連到外部網站</footer>
    </div>
  </div>

  <script>
    // ===== 外部網址（請修改這三個常數即可） =====
    const EXTERNAL_URL2 = 'https://shangdaofood.com/?gad_source=1&gad_campaignid=19168167064&gbraid=0AAAAABzIT70S8pzKjcNIbqNAtxGOJjalA&gclid=Cj0KCQjw8KrFBhDUARIsAMvIApZ6c0RlWZpy-HR-8fq5UIs15SnOiFBQbFaNXjYcMqliV_CzdFDMWFkaAtStEALw_wcB';
    const EXTERNAL_URL3 = 'testdrink.html';
    const EXTERNAL_URL4 = 'https://shangdaofood.com/product-category/online-shopping/';

    // ===== LocalStorage Key =====
    const STORE_KEY = 'stepper-demo';

    // ===== 步驟控制 =====
    const steps = Array.from(document.querySelectorAll('.stepper .step'));
    const panels = Array.from(document.querySelectorAll('.panels .panel'));
    const progress = document.getElementById('progressbar');
    let idx = 0; // 0-based

    // 僅開一次外部分頁（避免重複彈視窗）
    const openedOnce = {2:false, 3:false, 4:false};

    steps.forEach((tab, i) => {
      tab.addEventListener('click', () => go(i));
    });

    function go(i){
      idx = Math.max(0, Math.min(steps.length-1, i));
      steps.forEach((s,j)=>{
        s.classList.toggle('active', j===idx);
        s.classList.toggle('done', j<idx);
        s.setAttribute('aria-selected', j===idx ? 'true' : 'false');
      });
      panels.forEach((p,j)=>{
        p.classList.toggle('active', j===idx);
        p.setAttribute('aria-hidden', j===idx ? 'false' : 'true');
      });
      const ratio = (idx)/(steps.length-1);
      progress.style.width = (ratio*100) + '%';

      // 進到 Step2/3/4 時自動開啟對應連結（每步驟僅一次）
      if(idx === 1 && !openedOnce[2]) { window.open(EXTERNAL_URL2, '_blank', 'noopener'); openedOnce[2]=true; }
      if(idx === 2 && !openedOnce[3]) { window.open(EXTERNAL_URL3, '_blank', 'noopener'); openedOnce[3]=true; }
      if(idx === 3 && !openedOnce[4]) { window.open(EXTERNAL_URL4, '_blank', 'noopener'); openedOnce[4]=true; }
    }

    // 初始狀態
    go(0);

    // ===== 恢復暫存（若有） =====
    try {
      const saved = JSON.parse(localStorage.getItem(STORE_KEY) || 'null');
      if (saved) restore(saved);
    } catch (e) { console.warn('restore failed', e); }

    // ===== 綁定 Step 1 按鈕 =====
    document.getElementById('btnSave').addEventListener('click', () => {
      const data = collect();
      localStorage.setItem(STORE_KEY, JSON.stringify(data));
      alert('已暫存到瀏覽器（localStorage）。');
    });

    document.getElementById('btnSummit').addEventListener('click', () => {
      const data = collect();
      downloadJSON(data, 'stepper-data.json');
    });

    document.getElementById('btnGoExternal').addEventListener('click', () => go(1));

    // ===== 綁定 Step 2/3/4 元件 =====
    const linkBtn2 = document.getElementById('btnOpenLink2');
    const linkBtn3 = document.getElementById('btnOpenLink3');
    const linkBtn4 = document.getElementById('btnOpenLink4');
    linkBtn2.href = EXTERNAL_URL2; linkBtn3.href = EXTERNAL_URL3; linkBtn4.href = EXTERNAL_URL4;

    document.getElementById('btnBack2').addEventListener('click', () => go(0));
    document.getElementById('btnBack3').addEventListener('click', () => go(0));
    document.getElementById('btnBack4').addEventListener('click', () => go(0));

    // ===== Helpers =====
    function qs(sel) { return document.querySelector(sel); }
    function qsa(sel) { return Array.from(document.querySelectorAll(sel)); }
    function val(id) { return (qs('#' + id)?.value || '').trim(); }
    function checkedVals(name) { return qsa(`input[name="${name}"]:checked`).map(el => el.value); }
    function checkedVal(name) { return qs(`input[name="${name}"]:checked`)?.value || ''; }

    function collect() {
      const data = {
        date: val('date'),
        name: val('name'),
        gender: checkedVal('gender'),
        address: val('address'),
        course: val('course'),
        tel: val('tel'),
        mobile: val('mobile'),
        messenger: val('messenger'),
        email: val('email'),

        shop: checkedVals('shop'),
        shop_other: qs('.shop-note')?.value.trim() || '',

        biz: checkedVals('biz'),
        biz_other: qs('.biz-note')?.value.trim() || '',

        type: checkedVals('type'),
        courseName: checkedVals('courseName'),
        channel: checkedVals('channel'),

        area: checkedVals('area'),
        area_other: qs('.area-note')?.value.trim() || '',

        source: checkedVals('source'),
        source_other: qs('.source-note')?.value.trim() || '',

        demand: checkedVals('demand'),

        location: val('location'),
        interview: val('interview')
      };
      return data;
    }

    function restore(data) {
      const setVal = (id, v) => { const el = qs('#'+id); if (el) el.value = v || ''; };
      const setRadios = (name, v) => { if (!v) return; const el = qs(`input[name="${name}"][value="${CSS.escape(v)}"]`); if (el) el.checked = true; };
      const setChecks = (name, arr) => { if (!Array.isArray(arr)) return; arr.forEach(v => { const el = qs(`input[name="${name}"][value="${CSS.escape(v)}"]`); if (el) el.checked = true; }); };

      setVal('date', data.date);
      setVal('name', data.name);
      setRadios('gender', data.gender);
      setVal('address', data.address);
      setVal('course', data.course);
      setVal('tel', data.tel);
      setVal('mobile', data.mobile);
      setVal('messenger', data.messenger);
      setVal('email', data.email);

      setChecks('shop', data.shop);
      if (data.shop_other) { const n = qs('.shop-note'); if (n) n.value = data.shop_other; }

      setChecks('biz', data.biz);
      if (data.biz_other) { const n = qs('.biz-note'); if (n) n.value = data.biz_other; }

      setChecks('type', data.type);
      setChecks('courseName', data.courseName);
      setChecks('channel', data.channel);

      setChecks('area', data.area);
      if (data.area_other) { const n = qs('.area-note'); if (n) n.value = data.area_other; }

      setChecks('source', data.source);
      if (data.source_other) { const n = qs('.source-note'); if (n) n.value = data.source_other; }

      setChecks('demand', data.demand);

      setVal('location', data.location);
      setVal('interview', data.interview);
    }

    function downloadJSON(obj, filename='data.json') {
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
